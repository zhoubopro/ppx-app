<template>
  <view class="paper-wrap">

    <paperMenu
      :show="show"
      @hide="hidepopup"
      @addfriend="addfriend"
      @clear="clear">
    </paperMenu>

    <!-- å°çº¸æ¡åˆ—è¡¨ -->
    <block v-for="(item, index) in paperList.list" :key="index">
      <PaperList :index="index" :item="item"></PaperList>
    </block>

    <PullUpLoad :contentText="paperList.loadText"></PullUpLoad>
  </view>
</template>

<script>
  import PaperList from '../../components/paper-list/paper-list';
  import PullUpLoad from '../../components/pull-up-load/pull-up-load';
  import paperMenu from '../../components/paper-menu/paper-menu';

  export default {
    components: {
      PaperList,
      PullUpLoad,
      paperMenu
    },
    data() {
      return {
        show: false,
        paperList: {
          loadText: 'ä¸Šæ‹‰åŠ è½½æ›´å¤š',
          list: [
          {
            avatar: '../../static/demo/userpic/12.jpg',
            username: 'ç¥UPé›†åˆ',
            time: 'æ˜ŸæœŸå…­',
            msg: 'å¹¿åœºèˆå¤§å¦ˆå¸¦å‡ºæ¥å¸¦ç‹—å­ä»¬',
            msgNum: 10
          },
          {
            avatar: '../../static/demo/userpic/3.jpg',
            username: 'ç¥åŸåˆ›åˆé›†',
            time: 'æ˜ŸæœŸğŸˆšï¸',
            msg: 'èƒ½ä¸èƒ½æƒ³æˆ‘ä¸€æ ·ç¨³é‡ç‚¹',
            msgNum: 3
          },
          {
            avatar: '../../static/demo/userpic/6.jpg',
            username: 'å¨å¨',
            time: '19-07-01',
            msg: 'æ¥ä¸€èµ·',
          },{
              avatar: '../../static/demo/userpic/12.jpg',
              username: 'ç¥UPé›†åˆ',
              time: 'æ˜ŸæœŸå…­',
              msg: 'å¹¿åœºèˆå¤§å¦ˆå¸¦å‡ºæ¥å¸¦ç‹—å­ä»¬',
              msgNum: 10
            },
            {
              avatar: '../../static/demo/userpic/3.jpg',
              username: 'ç¥åŸåˆ›åˆé›†',
              time: 'æ˜ŸæœŸğŸˆšï¸',
              msg: 'èƒ½ä¸èƒ½æƒ³æˆ‘ä¸€æ ·ç¨³é‡ç‚¹',
              msgNum: 3
            },
            {
              avatar: '../../static/demo/userpic/6.jpg',
              username: 'å¨å¨',
              time: '19-07-01',
              msg: 'æ¥ä¸€èµ·',
            },{
              avatar: '../../static/demo/userpic/12.jpg',
              username: 'ç¥UPé›†åˆ',
              time: 'æ˜ŸæœŸå…­',
              msg: 'å¹¿åœºèˆå¤§å¦ˆå¸¦å‡ºæ¥å¸¦ç‹—å­ä»¬',
              msgNum: 10
            },
            {
              avatar: '../../static/demo/userpic/3.jpg',
              username: 'ç¥åŸåˆ›åˆé›†',
              time: 'æ˜ŸæœŸğŸˆšï¸',
              msg: 'èƒ½ä¸èƒ½æƒ³æˆ‘ä¸€æ ·ç¨³é‡ç‚¹',
              msgNum: 3
            },
            {
              avatar: '../../static/demo/userpic/6.jpg',
              username: 'å¨å¨',
              time: '19-07-01',
              msg: 'æ¥ä¸€èµ·',
            },{
              avatar: '../../static/demo/userpic/12.jpg',
              username: 'ç¥UPé›†åˆ',
              time: 'æ˜ŸæœŸå…­',
              msg: 'å¹¿åœºèˆå¤§å¦ˆå¸¦å‡ºæ¥å¸¦ç‹—å­ä»¬',
              msgNum: 10
            },
            {
              avatar: '../../static/demo/userpic/3.jpg',
              username: 'ç¥åŸåˆ›åˆé›†',
              time: 'æ˜ŸæœŸğŸˆšï¸',
              msg: 'èƒ½ä¸èƒ½æƒ³æˆ‘ä¸€æ ·ç¨³é‡ç‚¹',
              msgNum: 3
            },
            {
              avatar: '../../static/demo/userpic/6.jpg',
              username: 'å¨å¨',
              time: '19-07-01',
              msg: 'æ¥ä¸€èµ·',
            }
          ]
        }
      }
    },
    onReachBottom(){
      // ä¸Šæ‹‰åŠ è½½
      this.loadMore()
    },
    // ç›‘å¬ä¸‹æ‹‰åˆ·æ–°
    onPullDownRefresh(){
      this.getPaperData();
    },
    // ç›‘å¬å¯¼èˆªæŒ‰é’®ç‚¹å‡»äº‹ä»¶
    onNavigationBarButtonTap(e) {
      if (e.index  === 0 ){
          // this.User.navigate({
          uni.navigateTo({
            url: '../friends/friends',
          })
          this.hidepopup();
      }
      else {
        this.showpopup();
      }
    },
    onLoad(){
      console.log('xiaozhitiao')
    },
    methods: {
      getPaperData(){
        setTimeout(()=>{
          let arr = [
            {
              avatar: '../../static/demo/userpic/6.jpg',
              username: 'å¨å¨123',
              time: new Date(new Date().getTime()),
              msg: 'æ¥ä¸€èµ·',
            }
          ]
          this.paperList.list = this.paperList.list.concat(arr);
          uni.stopPullDownRefresh();
        }, 1000)
      },
      loadMore(){
        if(this.paperList.loadText !== "ä¸Šæ‹‰åŠ è½½æ›´å¤š") {
          return false;
        }
        // ä¿®æ”¹çŠ¶æ€
        this.paperList.loadText = "åŠ è½½ä¸­...";
        this.paperList.list.push({
          avatar: '../../static/demo/userpic/7.jpg',
          username: 'å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ',
          time: new Date(new Date().getTime()),
          msg: 'å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ',
        })
        this.paperList.loadText="ä¸Šæ‹‰åŠ è½½æ›´å¤š";
      },
      hidepopup(){
        this.show=false;
      },
      showpopup(){
        this.show=true;
      },
      // æ“ä½œèœå•
      addfriend(){
        // this.User.navigate({
        //   url: '../search/search?searchType=user',
        // })
        this.hidepopup();
      },
      clear(){
        // if (this.User.userinfo.id) {
        //   uni.removeStorageSync('noreadnum'+this.User.userinfo.id)
        //   uni.removeStorageSync('chatlist'+this.User.userinfo.id)
        //   this.$chat.initTabbarBadge();
        //   this.getdata();
        //   uni.showToast({
        //     title: 'æ¸…é™¤æˆåŠŸ'
        //   });
        // }
        this.hidepopup();
      },
    }
  }
</script>

<style scoped lang="less">
.paper-wrap{

}
</style>
